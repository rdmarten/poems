<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>reflections</title>

  <!-- Tufte CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css"/>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

  <style>
    :root{
      --ink:#111;
      --muted:#5c5c5c;
      --bloom-grey:#b8b8b8; /* light grey on bloom */
    }
    body{ background:#fff; color:var(--ink); }
    .pi-tufte{ max-width:70ch; margin:0 auto; }
    .poem{ font-size:1.05rem; line-height:1.6; }
    .poem p{ margin:0.45rem 0; }
    .reveal{ opacity:0; transform: translateY(12px); }

    /* Per-character */
    .char{ display:inline-block; will-change:transform, filter, color, opacity; }

    /* Bloom baseline look (subtle) */
    .gsap-bloom{ font-style: italic; } /* keep the same “bloom in italics” vibe */

    /* Mirrored opener */
    .mirror-wrap{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      gap:1rem; align-items:center; margin:0 0 1rem;
    }
    .mirror-sep{ width:1px; background:rgba(0,0,0,.08); height:1.4em; }
    .opener{ white-space:nowrap; } /* do not break “reflections” */
    .mirrored{ transform: scaleX(-1); opacity:.5; }

    /* Glow then illegible on hover/click */
    .glow{
      color:#343434;
      text-shadow: 0 0 .2em rgba(255,255,220,.35), 0 0 .6em rgba(255,255,180,.25);
      transition: filter .45s ease, color .45s ease, text-shadow .45s ease;
    }
    .glow.obscure:hover,
    .glow.obscure:active{
      color:#000;
      filter: blur(3px) contrast(1.2);
      text-shadow:none;
      cursor:not-allowed;
    }

    /* Hover-fade */
    .hover-fade{ transition: opacity .45s ease; }
    .hover-fade:hover{ opacity:0; }

    /* Balloon burst (“just fillers”) */
    .burst-line{ display:inline-block; }
    .burst-line .char{ transform-origin:center; }

    /* Droop / sag */
    .droop .char{ transform-origin: top center; }

    /* Bubble lines */
    .bubble-line .char{ position:relative; }

    /* thiccer / lifter / fitter */
    .thicker{ font-weight:600; display:inline-block; }
    .lifter{ display:inline-block; }
    .thinner{ font-weight:400; display:inline-block; }

    /* Tufte sidenote tweaks + blanks ready for images later */
    .marginnote a{ text-decoration:none; border-bottom:1px solid rgba(0,0,0,.2); padding-bottom:.05em; }
    .marginnote a:hover{ border-bottom-color: rgba(0,0,0,.5); }

    /* Final sidenote (hidden until click) */
    .final-note{ display:none; }

    /* Clickable word */
    .pc-trigger{ text-decoration: underline; text-decoration-thickness:.06em; cursor:pointer; }

    /* Back link */
    .back{ margin:3rem 0 4rem; font-size:.95rem; }
    .back a{ border-bottom:1px solid rgba(0,0,0,.25); text-decoration:none; }
    .back a:hover{ border-bottom-color:#000; }

    @media (max-width: 640px){
      .mirror-wrap{ grid-template-columns:1fr; gap:.25rem; }
      .mirror-sep{ display:none; }
      .mirrored{ opacity:.35; }
    }
  </style>
</head>
<body>
  <main class="pi-tufte">
    <article class="poem">

      <!-- Mirrored opener (no per-char; fades faintly) -->
      <div class="mirror-wrap reveal">
        <p class="opener">there are just too many reflections</p>
        <div class="mirror-sep" aria-hidden="true"></div>
        <p class="opener mirrored">there are just too many reflections</p>
      </div>

      <!-- Stanza 1 -->
      <p class="reveal">
        <span class="line gsap-bloom per-char">it used to be only in bathrooms,</span><br>
        <span class="line gsap-bloom per-char">the occasional hallway, or a</span><br>
        <span class="line gsap-bloom per-char">fancy bedroom—we see too much</span><br>
        <span class="line gsap-bloom per-char">of myself, everywhere, all the time—</span><br>
        <span class="line glow per-char">at least, mirrors used to contain light</span><br>
        <span class="line glow per-char">now they carry hydrocarbon stains</span>
      </p>

      <!-- Stanza 2 -->
      <p class="reveal">
        <span class="line gsap-bloom per-char">maybe I should take off my clothes</span><br>
        <span class="line gsap-bloom per-char">and perhaps you’d like me better</span><br>
        <span class="line hover-fade gsap-bloom per-char">terrified to grow old but no filters</span><br>
        <span class="line"> <span class="burst-line per-char">just fillers</span>: glycerin and matrixyl</span><br>
        <span class="line gsap-bloom per-char">argireline solutions and caffeine</span><br>
        <span class="line gsap-bloom per-char">organic cold-pressed rose hip oil</span>

        <!-- Empty product sidenote #1 (ready for your images) -->
        <label for="sn-1" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="sn-1" class="margin-toggle"/>
        <span class="marginnote"></span>
      </p>

      <!-- Stanza 3 -->
      <p class="reveal">
        <span class="line droop per-char">none of it will save my sagging skin</span><br>
        <span class="line gsap-bloom per-char">although maybe if we just keep buying</span><br>
        <span class="line gsap-bloom per-char">and staring at the vials and dispensers</span><br>
        <span class="line gsap-bloom per-char">on the shelves, the reflections change</span><br>
        <span class="line gsap-bloom per-char">not ours, but the ones in my brain</span><br>
        <span class="line gsap-bloom per-char">rewilding pathways to youth within</span>
      </p>

      <!-- Stanza 4 -->
      <p class="reveal">
        <span class="line bubble-line per-char">why would I take a long bath and risk</span><br>
        <span class="line bubble-line per-char">wrinkling everything, on purpose?</span><br>
        <span class="line">
          <span class="thicker">thiccer,</span>
          <span class="lifter">lifter,</span>
          <span class="thinner">fitter,</span>
          <span> triple-action,</span>
        </span><br>
        <span class="line gsap-bloom per-char">day-and-night serums, cleansers,</span><br>

        <!-- Empty product sidenote #2 (ready for your images) -->
        <label for="sn-2" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="sn-2" class="margin-toggle"/>
        <span class="marginnote"></span>

        <br>
        <span class="line gsap-bloom per-char">exfoliators, moisturising suspensions,</span><br>
        <span class="line gsap-bloom per-char">organic cold-pressed Moroccan argan oil</span>
      </p>

      <!-- Final couplet + hidden sidenote with autoplay video (revealed on click) -->
      <p class="reveal">
        <span class="line gsap-bloom per-char"><span id="pc-trigger" class="pc-trigger">‘Postmodern Cynicism’</span> exists only online,</span><br>
        <span class="line gsap-bloom per-char">you should go on his Facebook sometime</span>
        <span class="marginnote final-note" id="final-note">
          <div style="margin-top:.25rem;">
            <!-- src added on click for autoplay -->
            <iframe id="final-yt"
              width="300" height="169"
              title="YouTube video player" frameborder="0"
              allow="autoplay; encrypted-media; picture-in-picture; web-share"
              allowfullscreen
              data-src="https://www.youtube.com/embed/Do7B74dyEVs?autoplay=1&mute=1&controls=0&playsinline=1&rel=0">
            </iframe>
          </div>
        </span>
      </p>

      <p class="back">← <a href="./">back to poems</a></p>
    </article>
  </main>

  <script>
    gsap.registerPlugin(ScrollTrigger);

    /* ---------- tiny per-char splitter (skips sidenote UI) ---------- */
    function splitCharsIn(root){
      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
        acceptNode(n){
          return /\S/.test(n.nodeValue) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
        }
      });
      const nodes = [];
      while (walker.nextNode()) nodes.push(walker.currentNode);
      nodes.forEach(node=>{
        const parent = node.parentElement;
        if (parent && (parent.closest('.marginnote') || parent.closest('label') || parent.closest('input'))) return;
        const frag = document.createDocumentFragment();
        for (const ch of node.nodeValue){
          if (ch===' '){ frag.appendChild(document.createTextNode(' ')); continue; }
          const span = document.createElement('span');
          span.className = 'char'; span.textContent = ch;
          frag.appendChild(span);
        }
        node.parentNode.replaceChild(frag, node);
      });
    }
    document.querySelectorAll('.per-char').forEach(splitCharsIn);

    /* ---------- scroll reveal (scrubbed like your previous project) ---------- */
    document.querySelectorAll('.reveal').forEach((el)=>{
      const chars = el.querySelectorAll('.char');
      const tl = gsap.timeline({
        scrollTrigger:{ trigger: el, start:"top 85%", end:"bottom 60%", scrub:true }
      });
      if (chars.length){
        tl.fromTo(chars,{opacity:0, y:8, filter:'blur(1px)'},{opacity:1, y:0, filter:'blur(0px)', stagger:{each:0.01, from:'start'}});
      } else {
        tl.fromTo(el,{opacity:0, y:8},{opacity:1, y:0});
      }
    });

    /* ---------- mirrored opener fade (faintly disappear) ---------- */
    (function(){
      const wrap = document.querySelector('.mirror-wrap');
      if(!wrap) return;
      gsap.to(wrap.querySelectorAll('.opener'), {
        opacity: 0.15, duration: 1.6,
        scrollTrigger:{ trigger: wrap, start:"top 70%", end:"bottom 40%", scrub:true }
      });
    })();

    /* ---------- glow lines: readable first, then allow hover-obscure ---------- */
    document.querySelectorAll('.glow').forEach((el)=>{
      gsap.fromTo(el, {opacity:0.7, filter:'brightness(1)'},{
        opacity:1, filter:'brightness(1.12)', duration:1,
        scrollTrigger:{ trigger: el, start:"top 80%", once:true },
        onComplete(){ el.classList.add('obscure'); }
      });
    });

    /* ---------- hover-fade handled by CSS ---------- */

    /* ---------- “just fillers” balloon burst ---------- */
    (function(){
      const line = document.querySelector('.burst-line');
      if(!line) return;
      let burstDone = false;
      gsap.to(line.querySelectorAll('.char'), {
        scale: 1.03, yoyo: true, repeat: -1, duration: 1.4, ease: "sine.inOut",
        stagger: {each: 0.02, from: "random"}
      });
      function runBurst(){
        if(burstDone) return;
        burstDone = true;
        const chars = line.querySelectorAll('.char');
        const tl = gsap.timeline();
        tl.to(chars, {color:"var(--bloom-grey)", duration:0.25, ease:"power2.out"})
          .to(chars, {scale:2.4, duration:0.5, ease:"back.out(2)"}, "<")
          .to(chars, {
            duration:0.7, opacity:0,
            rotate:()=>gsap.utils.random(-35,35),
            x:()=>gsap.utils.random(-40,40),
            y:()=>gsap.utils.random(-60,-20),
            ease:"power2.in"
          }, ">-0.05");
      }
      line.addEventListener('mouseenter', runBurst);
      line.addEventListener('click', runBurst);
    })();

    /* ---------- droop / sag (fixed) ---------- */
    (function(){
      const droop = document.querySelector('.droop');
      if(!droop) return;
      const chars = droop.querySelectorAll('.char');
      ScrollTrigger.create({
        trigger: droop, start:"top 85%", once:true,
        onEnter(){
          const n = chars.length, center = (n-1)/2;
          chars.forEach((ch, i)=>{
            const dist = Math.abs(i-center);
            const drop = 14 * (1 - (dist/center || 1)) + gsap.utils.random(-2,2);
            gsap.to(ch, { y: drop, rotate: gsap.utils.random(-2,2), duration: 1.25, ease: "sine.out", delay: i*0.005 });
          });
        }
      });
    })();

    /* ---------- bubble-on-scroll (slower + gentler) ---------- */
    document.querySelectorAll('.bubble-line').forEach(line=>{
      const chars = line.querySelectorAll('.char');
      gsap.to(chars, {
        y: ()=> gsap.utils.random(-10,-4),
        x: ()=> gsap.utils.random(-4,4),
        repeat: -1, yoyo: true,
        duration: ()=> gsap.utils.random(2.2,3.2), /* slowed down */
        ease: "sine.inOut",
        stagger: {each: 0.03, from: "random"},
        scrollTrigger:{ trigger: line, start:"top 90%", end:"bottom 50%", scrub:true }
      });
    });

    /* ---------- thiccer / lifter / fitter animations ---------- */
    (function(){
      const stanza = document.querySelector('.thicker')?.closest('p');
      if(!stanza) return;
      ScrollTrigger.create({
        trigger: stanza, start:"top 85%", once:true,
        onEnter(){
          gsap.to('.thicker', { fontWeight: 900, duration: .5, ease: 'power2.out' });
          gsap.to('.lifter', { y: -8, duration: .6, ease: 'sine.out' });
          gsap.to('.thinner', { fontWeight: 200, duration: .5, ease: 'power2.out' });
        }
      });
    })();

    /* ---------- click-to-reveal final sidenote + autoplay video ---------- */
    (function(){
      const trigger = document.getElementById('pc-trigger');
      const note = document.getElementById('final-note');
      const yt = document.getElementById('final-yt');
      if(!trigger || !note || !yt) return;

      const showNote = () => {
        if (note.style.display !== 'inline-block'){
          note.style.display = 'inline-block';
          gsap.fromTo(note, {opacity:0, y:8}, {opacity:1, y:0, duration:0.5, ease:"power2.out"});
          // load + autoplay video on first reveal
          if (!yt.src) yt.src = yt.dataset.src;
        }
      };
      trigger.addEventListener('click', showNote);
      trigger.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); showNote(); }});
    })();

    /* ---------- bloom interaction (from previous project; now light grey) ---------- */
    (function(){
      const baseBlooms = Array.from(document.querySelectorAll('.gsap-bloom'));
      function bloom(line){
        const chars = line.querySelectorAll('.char');
        if (!chars.length) return;
        gsap.killTweensOf(chars);
        gsap.to(chars, {
          scale: 1.24,
          color: 'var(--bloom-grey)',
          duration: 0.6,
          yoyo: true,
          repeat: 1,
          ease: 'power1.inOut',
          stagger: 0.04
        });
      }
      baseBlooms.forEach(p=>{
        p.tabIndex = 0;
        p.addEventListener('pointerenter', ()=>bloom(p));
        p.addEventListener('click', ()=>bloom(p));
        p.addEventListener('focus', ()=>bloom(p));
      });
    })();
  </script>
    <p style="margin:0.5rem 0 1rem"><a href="../">← back to poems</a></p>
</body>
</html>
