<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>reflections</title>

  <!-- Tufte CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css"/>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

  <style>
    :root{
      --ink:#111;
      --muted:#5c5c5c;
      --faint:#9a9a9a;
      --dirty-green:#7c8f3a;
    }
    body{ background:#fff; color:var(--ink); }
    .pi-tufte{ max-width:70ch; margin:0 auto; }
    .poem{ font-size:1.05rem; line-height:1.6; }
    .poem p{ margin:0.45rem 0; }

    /* Per-character prep + the familiar bloom look */
    .char{
      display:inline-block;
      will-change:transform, filter, color, opacity;
      transform: translateY(0);
    }
    .bloom{
      color:var(--muted);
      text-shadow: 0 0 .25em rgba(0,0,0,.06), 0 .02em .1em rgba(0,0,0,.08);
      filter: blur(.15px);
    }

    /* Mirrored opener layout */
    .mirror-wrap{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      gap:1rem;
      align-items:center;
      margin:1.25rem 0 1.5rem;
    }
    .mirror-sep{ width:1px; background:rgba(0,0,0,.08); height:1.4em; }
    .mirrored{
      transform: scaleX(-1);
      opacity:.5;
    }

    /* Glow + illegible-on-hover */
    .glow{
      color:#343434;
      text-shadow: 0 0 .2em rgba(255,255,220,.35), 0 0 .6em rgba(255,255,180,.25);
      transition: filter .45s ease, color .45s ease, text-shadow .45s ease;
    }
    .glow.obscure:hover,
    .glow.obscure:active{
      color:#000;
      filter: blur(3px) contrast(1.2);
      text-shadow:none;
      cursor: not-allowed;
    }

    /* Hover-fade for the “filters” line */
    .hover-fade{
      transition: opacity .45s ease;
    }
    .hover-fade:hover{ opacity:0; }

    /* Balloon burst (just fillers) */
    .burst-line{ display:inline-block; }
    .burst-line .char{ transform-origin:center; }

    /* Sag/droop */
    .droop .char{
      display:inline-block;
      transform-origin: top center;
    }

    /* Bubble-on-scroll lines */
    .bubble-line .char{ position:relative; }

    /* Tufte helpers — margin notes look a tad tighter on mobile */
    .marginnote a{
      text-decoration:none;
      border-bottom:1px solid rgba(0,0,0,.2);
      padding-bottom:.05em;
    }
    .marginnote a:hover{
      border-bottom-color: rgba(0,0,0,.5);
    }

    /* Hide the final sidenote until end-of-scroll */
    .final-note{ display:none; }

    /* Back link */
    .back{
      margin:3rem 0 4rem;
      font-size:.95rem;
    }
    .back a{ border-bottom:1px solid rgba(0,0,0,.25); text-decoration:none; }
    .back a:hover{ border-bottom-color:#000; }

    /* Small screens: let the opener mirror stack */
    @media (max-width: 640px){
      .mirror-wrap{
        grid-template-columns: 1fr;
        gap:.25rem;
      }
      .mirror-sep{ display:none; }
      .mirrored{ opacity:.35; }
    }
  </style>
</head>
<body>
  <main class="pi-tufte">
    <article class="poem">

      <!-- Title + subtitle (Tufte style) -->
      <h1>reflections</h1>
      <p class="subtitle">a poem with scroll-unfold and small experiments in light</p>

      <!-- Mirrored opener -->
      <div class="mirror-wrap reveal bloom per-char">
        <p class="line opener">there are just too many reflections</p>
        <div class="mirror-sep" aria-hidden="true"></div>
        <p class="line opener mirrored">there are just too many reflections</p>
      </div>

      <!-- Stanza 1 -->
      <p class="reveal bloom per-char">
        it used to be only in bathrooms,
      </p>
      <p class="reveal bloom per-char">
        the occasional hallway, or a 
      </p>
      <p class="reveal bloom per-char">
        fancy bedroom—we see too much
      </p>
      <p class="reveal bloom per-char">
        of myself, everywhere, all the time—
      </p>

      <!-- Glow then illegible on hover -->
      <p class="reveal glow-line">
        <span class="glow per-char">at least, mirrors used to contain light</span><br>
        <span class="glow per-char">now they carry hydrocarbon stains</span>
      </p>

      <!-- Stanza 2 -->
      <p class="reveal bloom hover-fade per-char">
        terrified to grow old but no filters
      </p>
      <p class="reveal bloom">
        <span class="burst-line per-char">just fillers</span>: glycerin and matrixyl
      </p>
      <p class="reveal bloom per-char">
        argireline solutions and caffeine
      </p>

      <!-- Sidenote group #1 (The Ordinary links) -->
      <label for="sn-1" class="margin-toggle sidenote-number">⊕</label>
      <input type="checkbox" id="sn-1" class="margin-toggle"/>
      <span class="marginnote">
        Product rabbit-hole (The Ordinary):
        <ul>
          <li><a href="https://theordinary.com/en-gb/search?q=glycerin" target="_blank" rel="noopener">Glycerin</a></li>
          <li><a href="https://theordinary.com/en-gb/search?q=matrixyl" target="_blank" rel="noopener">Matrixyl 10% + HA</a></li>
          <li><a href="https://theordinary.com/en-gb/search?q=argireline" target="_blank" rel="noopener">Argireline Solution 10%</a></li>
          <li><a href="https://theordinary.com/en-gb/search?q=caffeine%20solution" target="_blank" rel="noopener">Caffeine Solution 5% + EGCG</a></li>
          <li><a href="https://theordinary.com/en-gb/search?q=rose%20hip%20oil" target="_blank" rel="noopener">100% Organic Cold-Pressed Rose Hip Seed Oil</a></li>
        </ul>
      </span>

      <p class="reveal bloom per-char">
        organic cold-pressed rose hip oil
      </p>

      <!-- Stanza 3 -->
      <p class="reveal bloom per-char droop">
        none of it will save my sagging skin
      </p>
      <p class="reveal bloom per-char">
        although maybe if we just keep buying
      </p>
      <p class="reveal bloom per-char">
        and staring at the vials and dispensers
      </p>
      <p class="reveal bloom per-char">
        on the shelves, the reflections change
      </p>
      <p class="reveal bloom per-char">
        not ours, but the ones in my brain
      </p>
      <p class="reveal bloom per-char">
        rewilding pathways to youth within
      </p>

      <!-- Stanza 4 — bubbling lines -->
      <p class="reveal bloom per-char bubble-line">
        why would I take a long bath and risk
      </p>
      <p class="reveal bloom per-char bubble-line">
        wrinkling everything, on purpose?
      </p>
      <p class="reveal bloom per-char">
        thiccer, lifter, fitter, triple-action, 
      </p>
      <p class="reveal bloom per-char">
        day-and-night serums, cleansers, 
      </p>

      <!-- Sidenote group #2 (The Ordinary links) -->
      <label for="sn-2" class="margin-toggle sidenote-number">⊕</label>
      <input type="checkbox" id="sn-2" class="margin-toggle"/>
      <span class="marginnote">
        Further temptations (The Ordinary):
        <ul>
          <li><a href="https://theordinary.com/en-gb/search?q=serum" target="_blank" rel="noopener">Serums (day &amp; night)</a></li>
          <li><a href="https://theordinary.com/en-gb/search?q=squalane%20cleanser" target="_blank" rel="noopener">Squalane Cleanser</a></li>
          <li><a href="https://theordinary.com/en-gb/search?q=exfoliating" target="_blank" rel="noopener">Exfoliators</a></li>
          <li><a href="https://theordinary.com/en-gb/search?q=natural%20moisturizing%20factors" target="_blank" rel="noopener">Natural Moisturizing Factors + HA</a></li>
          <li><a href="https://theordinary.com/en-gb/search?q=argan%20oil" target="_blank" rel="noopener">100% Organic Cold-Pressed Moroccan Argan Oil</a></li>
        </ul>
      </span>

      <p class="reveal bloom per-char">
        exfoliators, moisturising suspensions,
      </p>
      <p class="reveal bloom per-char">
        organic cold-pressed Moroccan argan oil
      </p>

      <!-- Final couplet + hidden sidenote with autoplay video -->
      <p class="reveal bloom per-char">
        ‘Postmodern Cynicism’ exists only online,
      </p>
      <p class="reveal bloom per-char">
        you should go on his Facebook sometime
      </p>

      <span class="marginnote final-note" id="final-note">
        Soundtrack appears when you reach the end:
        <div style="margin-top:.5rem;">
          <iframe
            width="300" height="169"
            src="https://www.youtube.com/embed/Do7B74dyEVs?autoplay=1&mute=1&controls=0&playsinline=1&rel=0"
            title="YouTube video player" frameborder="0"
            allow="autoplay; encrypted-media; picture-in-picture; web-share"
            allowfullscreen>
          </iframe>
        </div>
      </span>

      <p class="back">← <a href="./">back to poems</a></p>
    </article>
  </main>

  <script>
    // ---------------------------
    // Utilities
    // ---------------------------
    gsap.registerPlugin(ScrollTrigger);

    // Split a node’s text into char spans (preserving spaces)
    function splitChars(el){
      if(!el) return;
      if(el.dataset.split === '1') return;
      const nodes = [];
      [...el.childNodes].forEach(n=>{
        if(n.nodeType===Node.TEXT_NODE){
          const frag = document.createDocumentFragment();
          const text = n.textContent;
          for(const ch of text){
            const span = document.createElement('span');
            span.className = 'char';
            span.textContent = ch;
            if(ch===' ') span.style.width='0.35em';
            frag.appendChild(span);
          }
          nodes.push(frag);
        }else if(n.nodeType===Node.ELEMENT_NODE){
          // recurse into child elements
          splitChars(n);
          nodes.push(n);
        }
      });
      el.textContent='';
      nodes.forEach(x=>el.appendChild(x));
      el.dataset.split='1';
    }

    // Prepare all per-char targets
    document.querySelectorAll('.per-char').forEach(splitChars);

    // ---------------------------
    // Scroll-unfold + bloom
    // ---------------------------
    document.querySelectorAll('.reveal').forEach((el, i)=>{
      const chars = el.querySelectorAll('.char');
      const base = gsap.timeline({
        scrollTrigger:{
          trigger: el,
          start: "top 85%",
          end: "bottom 60%",
          scrub: true
        }
      });

      if(chars.length){
        base.fromTo(chars,
          {opacity:0, y:8, filter:'blur(1px)'},
          {opacity:1, y:0, filter:'blur(0px)', stagger:{each:0.01, from:'start'}}
        );
      }else{
        base.fromTo(el, {opacity:0, y:8}, {opacity:1, y:0});
      }

      // Subtle grey bloom to ink as it reveals
      if(el.classList.contains('bloom')){
        base.to(el, {duration:0.6, color:'var(--ink)', textShadow:'0 0 0 rgba(0,0,0,0)', filter:'blur(0px)'}, "<0.35");
      }
    });

    // ---------------------------
    // Mirrored opener fade
    // ---------------------------
    (function(){
      const wrap = document.querySelector('.mirror-wrap');
      if(!wrap) return;
      gsap.to(wrap.querySelectorAll('.opener'), {
        opacity: 0.15,
        duration: 1.6,
        scrollTrigger:{
          trigger: wrap,
          start: "top 70%",
          end: "bottom 40%",
          scrub: true
        }
      });
    })();

    // ---------------------------
    // Glow then illegible on hover
    // ---------------------------
    (function(){
      const glowLines = document.querySelectorAll('.glow-line .glow');
      glowLines.forEach((el)=>{
        // initial gentle glow ramp when entering view
        gsap.fromTo(el, {opacity:0.6, filter:'brightness(1)'},
          {
            opacity:1,
            filter:'brightness(1.12)',
            duration:1,
            scrollTrigger:{
              trigger: el,
              start: "top 80%",
              once: true
            },
            onComplete(){
              el.classList.add('obscure'); // enable hover-to-obscure after readable moment
            }
          }
        );
      });
    })();

    // ---------------------------
    // Hover fade (“terrified…no filters”)
    // (CSS handles opacity -> 0 on hover)
    // ---------------------------

    // ---------------------------
    // Balloon burst (“just fillers”)
    // ---------------------------
    (function(){
      const line = document.querySelector('.burst-line');
      if(!line) return;
      let burstDone = false;

      // gentle throb on scroll (inspired by glossy micro-interactions)
      gsap.to(line.querySelectorAll('.char'), {
        scale: 1.04,
        yoyo: true,
        repeat: -1,
        duration: 1.2,
        ease: "sine.inOut",
        stagger: {each: 0.02, from: "random"}
      });

      function runBurst(){
        if(burstDone) return;
        burstDone = true;
        const chars = line.querySelectorAll('.char');
        const tl = gsap.timeline();
        tl.to(chars, {color:"var(--dirty-green)", duration:0.25, ease:"power2.out"})
          .to(chars, {scale:2.4, duration:0.5, ease:"back.out(2)"}, "<")
          .to(chars, {
            duration:0.6,
            opacity:0,
            rotate:()=>gsap.utils.random(-35,35),
            x:()=>gsap.utils.random(-40,40),
            y:()=>gsap.utils.random(-60,-20),
            ease:"power2.in"
          }, ">-0.05");
      }

      line.addEventListener('mouseenter', runBurst);
      line.addEventListener('click', runBurst);
    })();

    // ---------------------------
    // Droop / sag (“none of it will save my sagging skin”)
    // ---------------------------
    (function(){
      const droop = document.querySelector('.droop');
      if(!droop) return;
      const chars = droop.querySelectorAll('.char');
      ScrollTrigger.create({
        trigger: droop,
        start: "top 80%",
        once: true,
        onEnter(){
          const n = chars.length;
          chars.forEach((ch, i)=>{
            // rope-like sag: middle drops most
            const center = (n-1)/2;
            const dist = Math.abs(i-center);
            const drop = 14 * (1 - (dist/center)) + gsap.utils.random(-2,2);
            gsap.to(ch, {
              y: drop,
              rotate: gsap.utils.random(-2,2),
              duration: 1.2,
              ease: "sine.out",
              delay: i*0.005
            });
          });
        }
      });
    })();

    // ---------------------------
    // Bubble-on-scroll (two lines)
    // ---------------------------
    (function(){
      document.querySelectorAll('.bubble-line').forEach(line=>{
        const chars = line.querySelectorAll('.char');
        gsap.to(chars, {
          y: ()=> gsap.utils.random(-18,-6),
          x: ()=> gsap.utils.random(-6,6),
          repeat: -1,
          yoyo: true,
          duration: ()=> gsap.utils.random(0.9,1.6),
          ease: "sine.inOut",
          stagger: {each: 0.02, from: "random"},
          scrollTrigger:{
            trigger: line,
            start: "top 85%",
            end: "bottom 50%",
            scrub: true
          }
        });
      });
    })();

    // ---------------------------
    // Reveal the final sidenote w/ video when reaching page end
    // ---------------------------
    (function(){
      const lastLine = document.querySelectorAll('.poem p.reveal').item(-1) || document.querySelector('.poem p:last-of-type');
      const finalNote = document.getElementById('final-note');
      if(!lastLine || !finalNote) return;

      ScrollTrigger.create({
        trigger: lastLine,
        start: "bottom 95%",
        onEnter(){
          finalNote.style.display = 'inline-block';
          // gentle pop-in
          gsap.fromTo(finalNote, {opacity:0, y:8}, {opacity:1, y:0, duration:0.6, ease:"power2.out"});
        }
      });
    })();
  </script>
   <!-- Back link -->
  <p style="margin:0.5rem 0 1rem"><a href="../">← back to poems</a></p>
</body>
</html>
