<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Book of Decay</title>
  <!-- Tufte CSS for typography -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css" />
  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <style>
    :root {
      --box-bg: rgba(255, 255, 255, 0.85);
      --box-fg: #111;
      --credit-bg: rgba(0, 0, 0, 0.55);
      --credit-fg: #fff;
      --max-width-ch: 32ch; /* narrow, to feel poetic - 38 default */
    }
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden; /* keep the experience contained */
      background: #000;
    }
    /* Full-viewport video */
    #bgvid {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;           /* fill on mobile */
      opacity: 0.85;               /* 85% as requested */
      z-index: 0;
      background: #000;            /* in case video is transparent */
    }
    /* Overlay layer for text boxes */
    .overlay {
      position: fixed;
      inset: 0;
      z-index: 2;
      pointer-events: none; /* child boxes turn this back on */
    }
    .poem-box {
      position: absolute;
      max-width: var(--max-width-ch);
      background: transparent; /* fully transparent box */
      color: var(--box-fg);
      border-radius: 14px;
      padding: 0.85rem 1rem;
      box-shadow: none; /* no visible box */
      pointer-events: auto; /* allow click events */
      transform: translate(-50%, -50%);
      text-align: left;
      opacity: 0;
      cursor: pointer;
    }
    .poem-box .et-book {
      font-size: 1.2rem;
      line-height: 1.65;
      font-family: 'et-book', 'Palatino Linotype', serif;
      margin: 0;
    }
    /* backlink box, hidden by default */
    .backlink {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      z-index: 3;
      background: var(--credit-bg);
      color: var(--credit-fg);
      padding: 0.35rem 0.75rem;
      border-radius: 4px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }
    .backlink.shown {
      opacity: 1;
      pointer-events: auto;
    }
    .backlink a {
      color: inherit;
      text-decoration: none;
      font-size: 0.88rem;
    }
    .backlink a:hover {
      text-decoration: underline;
    }
    /* credit box at bottom-right */
    .credit {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      z-index: 4;
      background: var(--credit-bg);
      color: var(--credit-fg);
      padding: 0.35rem 0.75rem;
      border-radius: 4px;
      font-size: 0.88rem;
    }
    .credit a {
      color: inherit;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <video autoplay loop muted playsinline id="bgvid" poster="">
    <source src="https://rdmarten.github.io/poems/decay/vid/decay.webm" type="video/webm" />
    <source src="https://rdmarten.github.io/poems/decay/vid/decay.mp4" type="video/mp4" />
  </video>
  <div class="overlay">
    <div class="poem-box" id="chunk">
      <p class="et-book" id="textEl"></p>
    </div>
  </div>
  <div class="credit et-book">
    Video by <a href="https://www.instagram.com/reel/DPPvy3rjlkg/?igsh=MTNodXE4YTRhcTFjeg%3D%3D" rel="noopener" target="_blank">Mailey Horner</a>
  </div>
  <script>
  (function() {
    const lines = [
      "Everything I held",
      "dissolved",
      "in slow motion.",
      "The walls I built",
      "collapsed",
      "into dust.",
      "Love turned",
      "to rust",
      "and crumbled.",
      "My dreams",
      "faded",
      "like old photographs.",
      "Beauty decayed",
      "before my eyes.",
      "Hope withered",
      "and fell.",
      "All that remains",
      "is the ghost",
      "of what once was."
    ];
    const chunk = document.getElementById('chunk');
    const textEl = document.getElementById('textEl');
    function fadeInChunk() {
      gsap.to(chunk, { opacity: 0.9, duration: 1.2, ease: 'power2.out' });
    }
    function fadeOutChunk() {
      gsap.to(chunk, { opacity: 0, duration: 0.85, ease: 'power2.in' });
    }
    function randomPos() {
      const margin = 15;
      const left  = margin + Math.random() * (100 - 2 * margin);
      const top   = margin + Math.random() * (100 - 2 * margin);
      return { left, top };
    }
    let current = 0;
    function showCurrent() {
      const { left, top } = randomPos();
      chunk.style.left = left + 'vw';
      chunk.style.top = top + 'vh';
      // re-apply translate centering in case any animation changed transform
      chunk.style.transform = 'translate(-50%, -50%)';
      textEl.textContent = lines[current];
      fadeInChunk();
    }
    const ADVANCE_DELAY_MS = 1200; // 2 seconds after click
    let pending = null;
    function advanceAfterDelay() {
      if (pending) clearTimeout(pending);
      pending = setTimeout(() => {
        current = (current + 1) % lines.length;
        showCurrent();
      }, ADVANCE_DELAY_MS);
    }
    // Clicking the text advances (no effect on video)
    chunk.addEventListener('click', (e) => {
      e.stopPropagation();
      advanceAfterDelay();
    });
    // Keep the element inside the viewport on resize/orientation change
    window.addEventListener('resize', () => {
      const { left, top } = randomPos();
      chunk.style.left = left + 'vw';
      chunk.style.top = top + 'vh';
    });
    // Robust backlink handler for constrained preview environments
    const backA = document.getElementById('backlink');
    if (backA) {
      backA.addEventListener('click', function(e){
        // In sandboxes/data URLs, default navigation may be blocked
        if (location.protocol === 'blob:' || location.protocol === 'data:') {
          e.preventDefault();
          if (history.length > 1) history.back();
          else window.location.href = this.getAttribute('href');
        }
      });
    }
    // Initial reveal
    showCurrent();
  })();
  </script>
  <div class="backlink et-book"><a href="../index.html" id="backlink">‚Üê back to poems</a></div>
</body>
</html>
