<!-- If using Code Injection (HEAD), you may instead include:
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css">
-->
<style>
  @import url("https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css");

  /* Layout + tighter spacing (keep as you set previously) */
  .pi-tufte { max-width: 70ch; margin: 0 auto; }
  .pi-tufte .poem { font-size: 0.50rem; line-height: 1.5; }
  .pi-tufte .poem p { margin: 0.15rem 0; }

  /* Italic helper */
  .pi-ital { font-style: italic; }

  /* Clickable audio word */
  .pi-audio { text-decoration: underline; cursor: pointer; }
  .pi-audio[aria-pressed="true"] { text-decoration: underline dotted; }
</style>

<article class="pi-tufte">
  <div class="poem">

    <!-- 1–4 (note on 1–3; 4 italic) -->
    <p>les galeries vénitiennes</p>
    <p>garde une jardin Japonais</p>
    <p>devant un puits artésien,
      <label for="sn-1" class="margin-toggle sidenote-number"></label>
      <input type="checkbox" id="sn-1" class="margin-toggle" />
      <span class="sidenote">the Venetian galleries<br>hide a Japanese garden<br>in front of an artesian well</span>
    </p>
    <p class="pi-ital">Palais des Thermes:</p>

    <!-- 5–10 (only 6–9 bloom) -->
    <p class="pi-ital">~</p>
    <p class="gsap-bloom">the gods are vulnerable</p>
    <p class="gsap-bloom">still so fertile, so soft</p>
    <p class="gsap-bloom">yet they’re dying out</p>
    <p class="gsap-bloom">in front of our eyes</p>
    <p class="pi-ital">~</p>

    <!-- 11–18 (shared sidenote) -->
    <p>art-deco exuberante</p>
    <p>frescos, des styles</p>
    <p>architecturaux</p>
    <p>classiques conservatrices</p>
    <p>culminant dans une</p>
    <p>forme éclectique</p>
    <p>avec des accents</p>
    <p>néo-Louis XV
      <label for="sn-2" class="margin-toggle sidenote-number"></label>
      <input type="checkbox" id="sn-2" class="margin-toggle" />
      <span class="sidenote">exuberant art deco<br>frescoes, with styles so<br>architecturally<br>classical conservative<br>culminating in an<br>eclectic form<br>with neo-accents<br>of Louis XV</span>
    </p>

    <!-- 19–26 (shared sidenote; 21 italic) -->
    <p>mes pours les mecs</p>
    <p>locales, c’était</p>
    <p class="pi-ital">de witten ooljefant</p>
    <p>chère, une modalité</p>
    <p>pour les riches</p>
    <p>les bourgeouis,</p>
    <p>pas nous, le peuple</p>
    <p>ordinaire, les marchants
      <label for="sn-3" class="margin-toggle sidenote-number"></label>
      <input type="checkbox" id="sn-3" class="margin-toggle" />
      <span class="sidenote">but for the lads,<br>the locals, it was<br>“the White Elephant”<br>expensive, a luxury<br>for the rich,<br>the bourgeoisie,<br>not us, the people,<br>the merchants</span>
    </p>

    <!-- 27–34 (shared sidenote; 29–32 italic) -->
    <p>ma ècole, une palais</p>
    <p>napoleonique</p>
    <p class="pi-ital">althans dat is wat</p>
    <p class="pi-ital">ze ons hadden</p>
    <p class="pi-ital">verteld, al lijkt daar</p>
    <p class="pi-ital">weinig echt van aan</p>
    <p>avec des anciens</p>
    <p>comme Ensor
      <label for="sn-4" class="margin-toggle sidenote-number"></label>
      <input type="checkbox" id="sn-4" class="margin-toggle" />
      <span class="sidenote">my school, a palace<br>in Napoleon-style<br>at least that's what<br>they told us,<br>although there seems to be<br>little truth in it<br>with alumni<br>like James Ensor (the painter)</span>
    </p>

    <!-- 35–40 (all italic) -->
    <p class="pi-ital">~</p>
    <p class="pi-ital">left with only memories</p>
    <p class="pi-ital">of roses, his beard, the scent</p>
    <p class="pi-ital">of lilacs, wild raspberries,</p>
    <p class="pi-ital">rumour of a long-eared owl</p>
    <p class="pi-ital">~</p>

    <!-- 41–45 (shared sidenote; 44–45 italic) -->
    <p>(en fait il n'y est</p>
    <p>resté que deux ans)</p>
    <p>comme Spilliaert</p>
    <p class="pi-ital">excentrieke ziener van</p>
    <p class="pi-ital">een vreemde realiteit
      <label for="sn-5" class="margin-toggle sidenote-number"></label>
      <input type="checkbox" id="sn-5" class="margin-toggle" />
      <span class="sidenote">(in fact, he only stayed there<br>for two years)<br>like Léon Spilliaert (another painter)<br>eccentric seer of<br>a strange reality</span>
    </p>

    <!-- 46–49 (shared sidenote) -->
    <p>fort militaire polygonal</p>
    <p>au bord de la mer</p>
    <p>à l'infini</p>
    <p>avant qu'il ne soit fini
      <label for="sn-6" class="margin-toggle sidenote-number"></label>
      <input type="checkbox" id="sn-6" class="margin-toggle" />
      <span class="sidenote">polygonal military fort<br>by the sea<br>into infinity<br>before it is all gone</span>
    </p>

    <!-- 50–51 (50 italic, GSAP drift + audio) -->
    <p class="pi-ital pi-line-50" tabindex="0">
      sehnsucht? <span id="pi-zeezucht" class="pi-audio" role="button" aria-pressed="false" tabindex="0">zeezucht</span>
    </p>
    <p>--------------------------</p>

  </div>

  <!-- Hidden YouTube player target -->
  <div id="yt-audio-holder" style="position:absolute;left:-9999px;top:-9999px;width:1px;height:1px;"></div>
</article>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" crossorigin="anonymous"></script>
<script src="https://unpkg.com/splitting/dist/splitting.min.js" crossorigin="anonymous"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
(function () {
  const root = document.querySelector('.pi-tufte');
  if (!root) return;
  const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Split only the lines we animate
  Splitting({ target: root.querySelectorAll('.gsap-bloom, .pi-line-50'), by: 'chars' });

  // --- Bloom (lines 6–9) ---
  function bloom(line) {
    if (reduce) return;
    const chars = line.querySelectorAll('.char');
    gsap.fromTo(chars,
      { scale: 1 },
      { scale: 1.14, duration: 0.45, yoyo: true, repeat: 1, ease: 'power1.inOut', stagger: { each: 0.035 } }
    );
  }
  root.querySelectorAll('.gsap-bloom').forEach(p => {
    p.tabIndex = 0;
    p.addEventListener('mouseenter', () => bloom(p));
    p.addEventListener('focus', () => bloom(p));
    p.addEventListener('mouseleave', () => gsap.killTweensOf(p.querySelectorAll('.char')));
    p.addEventListener('blur', () => gsap.killTweensOf(p.querySelectorAll('.char')));
  });

  // --- Line 50: wave + drift right on hover ---
  const l50 = root.querySelector('.pi-line-50');
  if (l50) {
    l50.addEventListener('mouseenter', () => {
      if (reduce) return;
      gsap.killTweensOf(l50);
      gsap.killTweensOf(l50.querySelectorAll('.char'));
      const tl = gsap.timeline();
      tl.to(l50.querySelectorAll('.char'),
            { y: -6, duration: 0.26, yoyo: true, repeat: 3, ease: 'sine.inOut', stagger: { each: 0.04 } }, 0)
        .to(l50, { x: window.innerWidth * 1.3, opacity: 0.85, duration: 4.8, ease: 'power1.inOut' }, 0);
    });
  }

  // --- YouTube audio on "zeezucht" with GSAP volume fade ---
  let player = null, ready = false, playing = false;
  const trigger = document.getElementById('pi-zeezucht');
  if (trigger) {
    const volumeProxy = { v: 0 };
    function fadeTo(target, dur, onComplete) {
      gsap.to(volumeProxy, {
        v: target, duration: dur, ease: 'power1.inOut',
        onUpdate() { try { player.setVolume(Math.round(volumeProxy.v)); } catch(e){} },
        onComplete
      });
    }
    function play() {
      if (!ready) return;
      try {
        player.setVolume(0);
        player.playVideo();
        trigger.setAttribute('aria-pressed', 'true');
        playing = true;
        fadeTo(70, 0.8);
      } catch (e) {}
    }
    function pause() {
      if (!ready) return;
      fadeTo(0, 0.6, () => {
        try { player.pauseVideo(); } catch (e) {}
        trigger.setAttribute('aria-pressed', 'false');
        playing = false;
      });
    }
    function toggle() { if (!ready) return; (playing ? pause() : play()); }

    trigger.addEventListener('click', (e) => { e.preventDefault(); toggle(); });
    trigger.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); }
    });

    // YouTube IFrame API
    const prev = window.onYouTubeIframeAPIReady;
    window.onYouTubeIframeAPIReady = function() {
      if (typeof prev === 'function') try { prev(); } catch(e){}
      player = new YT.Player('yt-audio-holder', {
        height: '1', width: '1',
        videoId: 'aeIzNh35VBA',
        playerVars: { controls: 0, modestbranding: 1 },
        events: { onReady: () => { ready = true; try { player.setVolume(0); } catch(e){} } }
      });
    };
    if (window.YT && YT.Player) window.onYouTubeIframeAPIReady();
  }
})();
</script>
