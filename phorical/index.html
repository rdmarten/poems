<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>maybe it’s all — scroll poem</title>

  <!-- Tufte CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css"/>

  <style>
    /* Layout + poem styling */
    .pi-tufte { max-width: 70ch; margin: 0 auto; }
    .poem { --lh: 1.45; line-height: var(--lh); font-size: 1.1rem; margin: 0 1rem; }
    .poem p { margin: 0.85rem 0; }

    /* 10 "lines" of whitespace at top and bottom (uses current line-height) */
    .vspace { height: calc(10 * 1em * var(--lh)); }

    /* Bracketed block */
    .bracketed {
      position: relative;
      padding-left: 2.2ch;
      padding-right: 2.2ch;
      margin: 1.1rem 0 1.2rem;
    }
    .bracketed::before,
    .bracketed::after {
      position: absolute;
      top: 0;
      bottom: 0;
      display: block;
      font-variant-numeric: tabular-nums;
      color: #555;
    }
    .bracketed::before {
      content: "[";
      left: 0;
      height: 1em;         /* show bracket glyph; simple, readable */
      top: 0;
      bottom: auto;
    }
    .bracketed::after {
      content: "]";
      right: 0;
      height: 1em;
      bottom: 0;
      top: auto;
    }

    .lines { display: grid; gap: 0.25rem; }

    /* Animated lines */
    .line {
      opacity: 0;
      transform: translateY(-0.6em);
      will-change: transform, opacity;
    }
    .line span.txt { display: inline-block; }

    /* Tufte sidenote sizing tweak */
    .poem .sidenote { max-width: 22rem; }
    @media (max-width: 760px) { .poem .sidenote { max-width: 100%; } }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .line { opacity: 1; transform: none; }
    }
  </style>
</head>
<body>
  <article class="pi-tufte">
    <section class="poem">

      <div class="vspace" aria-hidden="true"></div>

      <p>maybe it’s all</p>

      <div class="bracketed" aria-label="bracketed lines">
        <div class="lines" aria-live="polite">
          <div class="line"><span class="txt">just vibes,</span></div>
          <div class="line"><span class="txt">and slides,</span></div>
          <div class="line"><span class="txt">you know,</span></div>
          <div class="line"><span class="txt">metaphorical?*</span></div>
        </div>
      </div>

      <p>*Fuck off, most days I’m just barely phorical±</p>

      <p>
        ± φορά — fine, I’ll carry this meta-shit
        <!-- Tufte sidenote anchored to ± -->
        <label for="sn-1" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="sn-1" class="margin-toggle"/>
        <span class="sidenote">
          <em>φορά</em> (forá): “bearing, carrying” in Greek — as in <em>metaphor</em>,
          to carry across. Fine, I’ll carry this meta-stuff.
        </span>
      </p>

      <div class="vspace" aria-hidden="true"></div>

    </section>
  </article>

  <!-- GSAP + ScrollTrigger -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script>
    (function () {
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const lines = Array.from(document.querySelectorAll('.lines .line'));

      if (reduce || !lines.length) {
        lines.forEach(el => { el.style.opacity = 1; el.style.transform = 'none'; });
        return;
      }

      gsap.registerPlugin(ScrollTrigger);

      // Build a scrubbed, pinned timeline so the reveal is driven by scroll.
      const tl = gsap.timeline({
        defaults: { ease: 'power2.out' },
        scrollTrigger: {
          trigger: document.querySelector('.bracketed'),
          start: 'top 60%',
          end: () => '+=' + (lines.length * 200), // enough distance for stepwise reveals
          scrub: 0.5,
          pin: true,
          anticipatePin: 1
          // markers: true, // uncomment to debug
        }
      });

      lines.forEach((line, i) => {
        // Reveal this line
        tl.fromTo(line,
          { opacity: 0, y: -14 },
          { opacity: 1, y: 0, duration: 0.6 }
        );

        // Nudge the previous line as this one arrives for the "slide-into-each-other" feel
        if (i > 0) {
          tl.to(lines[i - 1], { y: 6, duration: 0.18, ease: 'power1.out' }, '<0.00');
          tl.to(lines[i - 1], { y: 0, duration: 0.22, ease: 'power1.inOut' }, '>-0.06');
        }

        // Slight overlap between steps so it feels continuous
        tl.addLabel('step' + i, '>-0.12');
      });
    })();
  </script>
</body>
</html>
