<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>barely phorical</title>

  <!-- Tufte CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css"/>

  <style>
    /* Base layout */
    .pi-tufte { max-width: 70ch; margin: 0 auto; }
    .poem { --lh: 1.45; line-height: var(--lh); font-size: 1.1rem; margin: 0 1rem; }
    .poem p { margin: 0.85rem 0; }

    /* 10 "lines" of whitespace before and after */
    .vspace { height: calc(10 * 1em * var(--lh)); }

    /* ===== Bracketed block matching the screenshot’s spacing ===== */
    .bracketed {
      --gapY: 10vh;     /* vertical distance between bracketed lines */
      --indent1: 0ch;   /* just vibes, */
      --indent2: 8ch;   /* and slides, */
      --indent3: 16ch;  /* you know, */
      --indent4: 32ch;  /* metaphorical?* */
      display: grid;
      row-gap: var(--gapY);
      margin: 2rem 0 2rem;
    }
    .bracket-open,
    .bracket-close {
      font-size: 1.35rem;
      color: #444;
      user-select: none;
    }

    /* Interactive lines: look like text, behave like buttons */
    .line {
      opacity: 0;
      transform: translateY(-0.6em);
      will-change: transform, opacity;
      display: inline-block;
      border: 0;
      background: none;
      padding: 0;
      margin: 0;
      text-align: left;
      cursor: default;       /* becomes pointer when active */
      font: inherit;
    }
    .line-1 { margin-left: var(--indent1); }
    .line-2 { margin-left: var(--indent2); }
    .line-3 { margin-left: var(--indent3); }
    .line-4 { margin-left: var(--indent4); }

    .line.is-active { cursor: pointer; }
    .line[disabled] { pointer-events: none; }

    /* Post-bracket lines stay hidden until the click chain completes */
    .reveal {
      opacity: 0;
      transform: translateY(12px);
      will-change: transform, opacity;
    }

    /* Tufte sidenote width tweak */
    .poem .sidenote { max-width: 22rem; }
    @media (max-width: 760px) { .poem .sidenote { max-width: 100%; } }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .line, .reveal, .bracket-close { opacity: 1; transform: none !important; }
    }
  </style>
</head>
<body>
  <article class="pi-tufte">
    <section class="poem">

      <div class="vspace" aria-hidden="true"></div>

      <p>maybe it’s all</p>

      <!-- Bracketed display -->
      <div class="bracketed" id="call-and-slide" aria-live="polite">
        <div class="bracket-open" aria-hidden="true">[</div>

        <!-- The four interactive lines -->
        <button class="line line-1" type="button"><span>just vibes,</span></button>
        <button class="line line-2" type="button" disabled><span>and slides,</span></button>
        <button class="line line-3" type="button" disabled><span>you know,</span></button>
        <button class="line line-4" type="button" disabled><span>metaphorical?*</span></button>

        <div class="bracket-close" id="bracket-close" aria-hidden="true" style="opacity:0; transform:translateY(-0.4em);">]</div>
      </div>

      <!-- After the bracket: these will NOT reveal until the chain is done -->
      <p class="reveal"><i>*Fuck off, most days I’m just barely phorical</i>±</p>

      <p class="reveal">
        ± φορά — fine, I’ll carry this meta-shit to nowhere
        <label for="sn-1" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="sn-1" class="margin-toggle"/>
        <span class="sidenote">
          <em>φορά</em> (forá): “bearing, carrying” in Greek — as in <em>metaphor</em>, to carry across.
        </span>
      </p>

      <div class="vspace" aria-hidden="true"></div>

    </section>
  </article>

  <!-- GSAP + plugins -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
  <script>
    (function () {
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      gsap.registerPlugin(ScrollTrigger, MotionPathPlugin);

      const wrap   = document.getElementById('call-and-slide');
      const closeB = document.getElementById('bracket-close');
      const lines  = [
        document.querySelector('.line-1'),
        document.querySelector('.line-2'),
        document.querySelector('.line-3'),
        document.querySelector('.line-4')
      ].filter(Boolean);

      const afterEls = gsap.utils.toArray('.reveal');   // post-bracket lines
      let chainComplete = false;

      /* -------------------- 0) Keep "after" lines hidden and inert -------------------- */
      // We will ONLY attach their ScrollTriggers after the chain is complete.

      function setupAfterScrollTriggers() {
        if (chainComplete) return; // avoid duplicate setup
        chainComplete = true;

        afterEls.forEach(el => {
          gsap.fromTo(el,
            { opacity: 0, y: 12 },
            {
              opacity: 1, y: 0, duration: 0.55, ease: 'power2.out',
              scrollTrigger: { trigger: el, start: 'top 85%', once: true }
            }
          );
        });
      }

      /* -------------------- 1) Auto-reveal the first line on scroll-in -------------------- */
      if (reduce) {
        lines.forEach((el, i) => {
          el.style.opacity = i === 0 ? 1 : 0;
          el.style.transform = i === 0 ? 'none' : '';
        });
        lines[0].classList.add('is-active');
      } else {
        gsap.fromTo(lines[0],
          { opacity: 0, y: -14 },
          {
            opacity: 1,
            y: 0,
            duration: 0.6,
            scrollTrigger: { trigger: wrap, start: 'top 70%', once: true },
            onComplete: () => lines[0].classList.add('is-active')
          }
        );
      }

      /* -------------------- 2) Click chain with a “playground slide” path -------------------- */
      function slideIntoNext(i) {
        const current = lines[i];
        const next    = lines[i + 1];

        if (!current || !next || current.disabled) return;

        // measure present positions to derive a down-right curve
        const r1 = current.getBoundingClientRect();
        const r2 = next.getBoundingClientRect();
        const dx = (r2.left - r1.left) * 0.98;      // slide roughly to next indent
        const dy = (r2.top  - r1.top)  * 0.98;      // slide down toward the next line

        current.disabled = true;

        const tl = gsap.timeline({ defaults: { ease: 'power2.out' } });

        // Curved slide down-and-right (like a playground slide)
        tl.to(current, {
          duration: 0.7,
          ease: 'power2.inOut',
          motionPath: {
            // gentle curve: start -> control point -> end
            path: [
              { x: 0,             y: 0 },
              { x: dx * 0.65,     y: dy * 0.45 },  // curve arc
              { x: dx,            y: dy - 2 }
            ],
            curviness: 1.25,
            autoRotate: false
          }
        });

        // Little bump on impact + reveal the next line
        tl.to(current, { x: dx + 2, y: dy + 10, duration: 0.12, ease: 'power1.out' }, '>-0.02');
        tl.fromTo(next, { opacity: 0, y: -18 }, { opacity: 1, y: 0, duration: 0.42, ease: 'back.out(1.6)' }, '<0.02');

        // Return the current line to its original spot
        tl.to(current, { x: 0, y: 0, duration: 0.45, ease: 'back.out(1.8)' })
          .add(() => {
            current.classList.remove('is-active');
            next.disabled = false;
            next.classList.add('is-active');
          });

        // If we just revealed the final line, show closing bracket then enable after-lines
        if (i === lines.length - 2) {
          tl.fromTo(closeB, { opacity: 0, y: -8 }, { opacity: 1, y: 0, duration: 0.45, ease: 'power2.out' })
            .add(setupAfterScrollTriggers);
        }
      }

      lines.forEach((btn, idx) => btn.addEventListener('click', () => slideIntoNext(idx)));

      /* -------------------- 3) Reduced motion: finish chain immediately, then enable after -------------------- */
      if (reduce) {
        // Immediately show all bracket lines and the closing bracket; then allow after-lines to scroll-reveal.
        lines.forEach(el => { el.style.opacity = 1; el.disabled = false; el.classList.remove('is-active'); });
        closeB.style.opacity = 1;
        setupAfterScrollTriggers();
      }
    })();
  </script>
  <p style="margin:0.5rem 0 1rem"><a href="../">← back to poems</a></p>
</body>
</html>
