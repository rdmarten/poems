<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>maybe it’s all — interactive poem</title>

  <!-- Tufte CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css"/>

  <style>
    /* Base layout */
    .pi-tufte { max-width: 70ch; margin: 0 auto; }
    .poem { --lh: 1.45; line-height: var(--lh); font-size: 1.1rem; margin: 0 1rem; }
    .poem p { margin: 0.85rem 0; }

    /* 10 "lines" of whitespace before and after */
    .vspace { height: calc(10 * 1em * var(--lh)); }

    /* ===== Bracketed block that matches your screenshot’s structure ===== */
    .bracketed {
      /* Vertical rhythm: big gaps between each line */
      --gapY: 10vh;                 /* increase/decrease to taste */
      --indent1: 0ch;               /* just vibes, */
      --indent2: 8ch;               /* and slides, */
      --indent3: 16ch;              /* you know, */
      --indent4: 32ch;              /* metaphorical?* (far to the right) */

      display: grid;
      row-gap: var(--gapY);
      margin: 2rem 0 2rem;
    }

    /* Open/close brackets on their own rows */
    .bracket-open,
    .bracket-close {
      font-size: 1.35rem;
      color: #444;
      user-select: none;
    }

    /* Individual line placement + look */
    .line {
      opacity: 0;
      transform: translateY(-0.6em);
      will-change: transform, opacity;
      display: inline-block;
      border: 0;
      background: none;
      padding: 0;
      margin: 0;
      text-align: left;
      cursor: default;          /* becomes pointer when the line is "active" */
      font: inherit;            /* look like text, not a button */
    }

    .line-1 { margin-left: var(--indent1); }
    .line-2 { margin-left: var(--indent2); }
    .line-3 { margin-left: var(--indent3); }
    .line-4 { margin-left: var(--indent4); }

    /* Only the current "trigger" line is clickable */
    .line.is-active { cursor: pointer; }
    .line[disabled] { pointer-events: none; }

    /* Post-bracket lines scroll-reveal */
    .reveal {
      opacity: 0;
      transform: translateY(12px);
      will-change: transform, opacity;
    }

    /* Tufte sidenote width tweak */
    .poem .sidenote { max-width: 22rem; }
    @media (max-width: 760px) { .poem .sidenote { max-width: 100%; } }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .line, .reveal { opacity: 1; transform: none; }
    }
  </style>
</head>
<body>
  <article class="pi-tufte">
    <section class="poem">

      <div class="vspace" aria-hidden="true"></div>

      <p>maybe it’s all</p>

      <!-- Bracketed display that mirrors your screenshot -->
      <div class="bracketed" id="call-and-slide" aria-live="polite">
        <div class="bracket-open" aria-hidden="true">[</div>

        <!-- The four interactive lines -->
        <button class="line line-1" type="button"><span>just vibes,</span></button>
        <button class="line line-2" type="button" disabled><span>and slides,</span></button>
        <button class="line line-3" type="button" disabled><span>you know,</span></button>
        <button class="line line-4" type="button" disabled><span>metaphorical?*</span></button>

        <div class="bracket-close" id="bracket-close" aria-hidden="true" style="opacity:0; transform:translateY(-0.4em);">]</div>
      </div>

      <!-- After the bracket: normal scroll reveal continues -->
      <p class="reveal">*Fuck off, most days I’m just barely phorical±</p>

      <p class="reveal">
        ± φορά — fine, I’ll carry this meta-shit
        <label for="sn-1" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="sn-1" class="margin-toggle"/>
        <span class="sidenote">
          <em>φορά</em> (forá): “bearing, carrying” in Greek — as in <em>metaphor</em>, to carry across.
        </span>
      </p>

      <div class="vspace" aria-hidden="true"></div>

    </section>
  </article>

  <!-- GSAP + ScrollTrigger -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script>
    (function () {
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      const lines = [
        document.querySelector('.line-1'),
        document.querySelector('.line-2'),
        document.querySelector('.line-3'),
        document.querySelector('.line-4')
      ].filter(Boolean);

      const closeBracket = document.getElementById('bracket-close');
      const bracketWrap  = document.getElementById('call-and-slide');

      if (!lines.length) return;

      gsap.registerPlugin(ScrollTrigger);

      /* -------- 1) Auto-reveal the first bracket line on scroll-in -------- */
      if (reduce) {
        lines.forEach((el, i) => {
          el.style.opacity = i === 0 ? 1 : 0;
          el.style.transform = i === 0 ? 'none' : '';
        });
        lines[0].classList.add('is-active');
      } else {
        gsap.fromTo(lines[0],
          { opacity: 0, y: -14 },
          {
            opacity: 1,
            y: 0,
            duration: 0.6,
            scrollTrigger: {
              trigger: bracketWrap,
              start: 'top 70%',
              once: true
            },
            onComplete: () => lines[0].classList.add('is-active')
          }
        );
      }

      /* -------- 2) Click chain: each line bumps + reveals the next -------- */
      function chainReveal(i) {
        const current = lines[i];
        const next    = lines[i + 1];

        if (!current || !next || current.disabled) return;

        // disable repeated clicks while animating
        current.disabled = true;

        const tl = gsap.timeline({ defaults: { ease: 'power2.out' } });

        // "Bump" the current line down and back
        tl.to(current, { y: 10, duration: 0.18, ease: 'power1.out' })
          .to(current, { y: 0,  duration: 0.22, ease: 'power1.inOut' }, '>-0.06');

        // Reveal the next line slightly after the bump starts
        tl.fromTo(next,
          { opacity: 0, y: -14 },
          { opacity: 1, y: 0, duration: 0.6 },
          '<0.05'
        ).add(() => {
          next.disabled = false;
          next.classList.add('is-active');
          current.classList.remove('is-active');
        });

        // After the last line appears, reveal the closing bracket
        if (i === lines.length - 2) {
          tl.fromTo(closeBracket,
            { opacity: 0, y: -8 },
            { opacity: 1, y: 0, duration: 0.45, ease: 'power2.out' },
            '>-0.10'
          );
        }
      }

      lines.forEach((btn, idx) => {
        btn.addEventListener('click', () => chainReveal(idx));
      });

      /* -------- 3) Resume normal scroll-reveal for post-bracket lines ------- */
      const after = gsap.utils.toArray('.reveal');
      if (!reduce) {
        after.forEach(el => {
          gsap.fromTo(el,
            { opacity: 0, y: 12 },
            {
              opacity: 1, y: 0, duration: 0.55, ease: 'power2.out',
              scrollTrigger: { trigger: el, start: 'top 85%', once: true }
            }
          );
        });
      } else {
        after.forEach(el => { el.style.opacity = 1; el.style.transform = 'none'; });
      }
    })();
  </script>
</body>
</html>
